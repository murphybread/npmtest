name: PNPM vs NPM Install Performance Test (Blank Project)

on:
  push:
    branches:
      - main # 테스트할 브랜치명
  workflow_dispatch: # GitHub Actions 탭에서 수동 실행 가능

jobs:
  test-install-performance:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Show initial disk space
        run: df -h .

      # --- PNPM Installation Tests ---
      - name: Setup Node.js and PNPM Cache
        uses: actions/setup-node@v4
        with:
          node-version: "20.x"
          cache: "pnpm" # pnpm 글로벌 스토어 캐싱 설정

      # 이전에 있던 'Enable Corepack and Install latest PNPM' 스텝은 제거하거나 내용을 수정합니다.
      # corepack enable은 setup-node v4에서 이미 처리될 수 있습니다.
      # 핵심은 pnpm prepare --activate를 install 전에 실행하는 것입니다.

      - name: PNPM Install - Run 1 (Simulate Cold Cache for node_modules)
        run: |
          echo "--- Running pnpm install (Run 1 - Cold node_modules) ---"
          rm -rf node_modules pnpm-lock.yaml package-lock.json
          # Make pnpm available in THIS shell session
          corepack prepare pnpm@latest --activate
          time pnpm install
          echo "--- Disk usage after PNPM Install Run 1 ---"
          du -sh node_modules
          echo "--- Total disk space after PNPM Install Run 1 ---"
          df -h .

      - name: PNPM Install - Run 2 (Simulate Warm Cache for PNPM store)
        run: |
          echo "--- Running pnpm install (Run 2 - Warm pnpm store) ---"
          rm -rf node_modules
          # Make pnpm available in THIS shell session
          corepack prepare pnpm@latest --activate
          time pnpm install
          echo "--- Disk usage after PNPM Install Run 2 ---"
          du -sh node_modules
          echo "--- Total disk space after PNPM Install Run 2 ---"
          df -h .

      - name: PNPM Install - Run 3 (Simulate Warm Cache for PNPM store)
        run: |
          echo "--- Running pnpm install (Run 3 - Warm pnpm store) ---"
          rm -rf node_modules
          # Make pnpm available in THIS shell session
          corepack prepare pnpm@latest --activate
          time pnpm install
          echo "--- Disk usage after PNPM Install Run 3 ---"
          du -sh node_modules
          echo "--- Total disk space after PNPM Install Run 3 ---"
          df -h .

      # --- NPM Installation Tests --- (이 부분은 동일)
      - name: Setup Node.js (for NPM test)
        uses: actions/setup-node@v4
        with:
          node-version: "20.x"

      - name: NPM Install - Run 1 (Simulate Cold Cache)
        run: |
          echo "--- Running npm install (Run 1 - Cold cache simulation) ---"
          rm -rf node_modules package-lock.json pnpm-lock.yaml
          time npm install
          echo "--- Disk usage after NPM Install Run 1 ---"
          du -sh node_modules
          echo "--- Total disk space after NPM Install Run 1 ---"
          df -h .

      - name: NPM Install - Run 2
        run: |
          echo "--- Running npm install (Run 2 - NPM default cache) ---"
          rm -rf node_modules
          time npm install
          echo "--- Disk usage after NPM Install Run 2 ---"
          du -sh node_modules
          echo "--- Total disk space after NPM Install Run 2 ---"
          df -h .

      - name: NPM Install - Run 3
        run: |
          echo "--- Running npm install (Run 3 - NPM default cache) ---"
          rm -rf node_modules
          time npm install
          echo "--- Disk usage after NPM Install Run 3 ---"
          du -sh node_modules
          echo "--- Total disk space after NPM Install Run 3 ---"
          df -h .

      - name: Show final disk space
        run: df -h .
